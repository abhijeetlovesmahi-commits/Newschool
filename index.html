<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Lalit - Supreme ERP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; color: #0f172a; }
        .glass-panel { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 32px; box-shadow: 0 20px 50px -12px rgba(0,0,0,0.05); }
        .input-box { @apply w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-500 focus:bg-white transition-all text-[13px] font-medium; }
        .input-label { @apply text-[10px] font-extrabold text-slate-400 uppercase tracking-widest ml-1 mb-1.5 block; }
        .btn-grad { background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%); box-shadow: 0 10px 20px -5px rgba(99, 102, 241, 0.4); }
        .photo-upload { border: 2px dashed #e2e8f0; @apply transition-all hover:border-indigo-400 hover:bg-indigo-50/30; }
    </style>
</head>
<body class="p-4 md:p-8">

    <nav class="max-w-6xl mx-auto flex justify-between items-center mb-10">
        <div>
            <h1 class="text-2xl font-extrabold tracking-tighter">THE LALIT <span class="text-indigo-600">SYSTEM</span></h1>
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Enterprise Resource Planning</p>
        </div>
        <div class="flex gap-3">
            <div class="bg-white border px-4 py-2 rounded-2xl shadow-sm text-center">
                <p class="text-[9px] font-bold text-slate-400 uppercase">Total Students</p>
                <p id="totalCount" class="text-sm font-extrabold text-indigo-600">0</p>
            </div>
        </div>
    </nav>

    <div class="max-w-6xl mx-auto">
        <div class="glass-panel p-8 md:p-10 mb-12">
            <div class="flex items-center gap-4 mb-8">
                <div class="w-10 h-10 bg-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-indigo-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
                </div>
                <div>
                    <h2 id="formTitle" class="text-xl font-extrabold text-slate-800">Student Enrollment</h2>
                    <p class="text-xs text-slate-400 font-medium">Fill in the comprehensive student profile details below.</p>
                </div>
            </div>

            <input type="hidden" id="editId">
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-10">
                <div class="md:col-span-3 flex flex-col items-center">
                    <div class="photo-upload w-full aspect-square rounded-[2.5rem] flex flex-col items-center justify-center relative overflow-hidden group">
                        <img id="imgPreview" src="" class="absolute inset-0 w-full h-full object-cover hidden">
                        <div id="uploadPlaceholder" class="text-center p-4">
                            <div class="w-12 h-12 bg-indigo-50 text-indigo-500 rounded-2xl flex items-center justify-center mx-auto mb-3">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            </div>
                            <p class="text-[10px] font-bold text-slate-400 uppercase">Tap to Upload Photo</p>
                        </div>
                        <input type="file" id="photoInput" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" onchange="previewPhoto(this)">
                    </div>
                </div>

                <div class="md:col-span-9">
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-x-5 gap-y-4">
                        
                        <div class="col-span-2 md:col-span-2">
                            <label class="input-label">Student Full Name *</label>
                            <input type="text" id="sName" placeholder="e.g. Rahul Kumar" class="input-box">
                        </div>
                        <div class="col-span-1">
                            <label class="input-label">Date of Birth</label>
                            <input type="date" id="sDob" class="input-box">
                        </div>

                        <div>
                            <label class="input-label">Assign Class *</label>
                            <select id="sClass" class="input-box text-indigo-600 font-bold">
                                <option value="Pre-Nursery">Pre-Nursery</option>
                                <option value="Nursery">Nursery</option>
                                <option value="LKG">LKG</option>
                                <option value="UKG">UKG</option>
                                <script>for(let i=1; i<=12; i++) document.write(`<option value="${i}th">${i}th</option>`);</script>
                            </select>
                        </div>
                        <div>
                            <label class="input-label">Section</label>
                            <select id="sSection" class="input-box"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option></select>
                        </div>
                        <div>
                            <label class="input-label">Gender</label>
                            <select id="sGender" class="input-box"><option value="Male">Male</option><option value="Female">Female</option></select>
                        </div>

                        <div class="col-span-1">
                            <label class="input-label">Father's Name</label>
                            <input type="text" id="fName" placeholder="Father's Name" class="input-box">
                        </div>
                        <div class="col-span-1">
                            <label class="input-label">Mother's Name</label>
                            <input type="text" id="mName" placeholder="Mother's Name" class="input-box">
                        </div>
                        <div class="col-span-1">
                            <label class="input-label">Aadhaar Number</label>
                            <input type="number" id="sAadhar" placeholder="12 Digit ID" class="input-box">
                        </div>

                        <div>
                            <label class="input-label">Primary Mobile *</label>
                            <input type="tel" id="sPhone" placeholder="10 Digit Number" class="input-box">
                        </div>
                        <div>
                            <label class="input-label">WhatsApp Number</label>
                            <input type="tel" id="sWhatsapp" placeholder="Optional" class="input-box">
                        </div>
                        <div class="col-span-1">
                            <label class="input-label">Emergency Contact</label>
                            <input type="tel" id="ePhone" placeholder="Guardian Phone" class="input-box">
                        </div>

                        <div class="col-span-2 md:col-span-3">
                            <label class="input-label">Residential Address</label>
                            <input type="text" id="sAddress" placeholder="Full Home Address" class="input-box">
                        </div>
                    </div>

                    <div class="mt-10 flex gap-4">
                        <button onclick="saveStudent()" id="saveBtn" class="btn-grad flex-1 md:flex-none md:px-16 text-white font-bold py-4 rounded-2xl text-xs uppercase tracking-[0.2em]">Register Student</button>
                        <button onclick="location.reload()" id="cancelBtn" class="hidden bg-slate-200 text-slate-600 px-10 py-4 rounded-2xl font-bold text-xs uppercase tracking-widest">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-6 items-center justify-between mb-8 px-2">
            <h3 class="text-xl font-extrabold text-slate-800 tracking-tight">Student Directory</h3>
            <div class="w-full md:w-96 relative">
                <input type="text" id="searchInput" onkeyup="searchStudent()" placeholder="Search directory..." class="w-full p-4 pl-12 bg-white border border-slate-200 rounded-3xl outline-none focus:ring-4 focus:ring-indigo-500/5">
                <svg class="w-5 h-5 absolute left-4 top-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        </div>

        <div id="studentContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            </div>
    </div>

    <script>
        // Firebase Configuration (Aapka purana wala hi hai)
        const firebaseConfig = {
            apiKey: "AIzaSyDqDmsMp2eAuHJBcjW-ciO2JcLTXapiIrs",
            authDomain: "the-lalit-d7472.firebaseapp.com",
            projectId: "the-lalit-d7472",
            storageBucket: "the-lalit-d7472.firebasestorage.app",
            messagingSenderId: "479237084229",
            appId: "1:479237084229:web:f1da384b45c5883b12ff2c"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let studentPhoto = "";

        function previewPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => { 
                    document.getElementById('imgPreview').src = e.target.result;
                    document.getElementById('imgPreview').classList.remove('hidden');
                    document.getElementById('uploadPlaceholder').classList.add('hidden');
                    studentPhoto = e.target.result; 
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function saveStudent() {
            const id = document.getElementById('editId').value;
            const data = {
                name: document.getElementById('sName').value,
                dob: document.getElementById('sDob').value,
                gender: document.getElementById('sGender').value,
                class: document.getElementById('sClass').value,
                section: document.getElementById('sSection').value,
                father: document.getElementById('fName').value,
                mother: document.getElementById('mName').value,
                phone: document.getElementById('sPhone').value,
                whatsapp: document.getElementById('sWhatsapp').value,
                aadhar: document.getElementById('sAadhar').value,
                address: document.getElementById('sAddress').value,
                photo: studentPhoto
            };

            if(!data.name || !data.class || !data.phone) return alert("Fill Name, Class and Phone!");

            if(id) {
                await db.collection("students").doc(id).update(data);
                alert("Profile Updated!");
            } else {
                const snap = await db.collection("students").get();
                data.idNumber = "LALIT-" + (snap.size + 101);
                data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                await db.collection("students").add(data);
                alert("Student Registered!");
            }
            location.reload();
        }

        function loadData() {
            db.collection("students").orderBy("createdAt", "desc").onSnapshot((snap) => {
                const container = document.getElementById('studentContainer');
                document.getElementById('totalCount').innerText = snap.size;
                container.innerHTML = "";
                snap.forEach(doc => {
                    const s = doc.data();
                    container.innerHTML += `
                        <div class="bg-white p-5 rounded-[2rem] border border-slate-100 shadow-sm hover:shadow-xl transition-all student-card" data-search="${s.name.toLowerCase()}">
                            <div class="flex items-center gap-4 mb-5">
                                <img src="${s.photo || 'https://ui-avatars.com/api/?name='+s.name}" class="w-14 h-14 rounded-2xl object-cover shadow-sm">
                                <div>
                                    <h4 class="font-extrabold text-slate-800 text-sm leading-tight">${s.name}</h4>
                                    <p class="text-[9px] font-black text-indigo-500 uppercase tracking-widest">${s.idNumber}</p>
                                </div>
                            </div>
                            <div class="bg-slate-50 rounded-2xl p-4 space-y-2 mb-5">
                                <div class="flex justify-between text-[10px] font-bold"><span class="text-slate-400">Class:</span><span class="text-slate-700">${s.class}-${s.section}</span></div>
                                <div class="flex justify-between text-[10px] font-bold"><span class="text-slate-400">Phone:</span><span class="text-slate-700">${s.phone}</span></div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editDoc('${doc.id}', ${JSON.stringify(s).replace(/"/g, '&quot;')})" class="flex-1 bg-slate-900 text-white py-3 rounded-xl text-[9px] font-black uppercase tracking-widest">Edit</button>
                                <button onclick="deleteDoc('${doc.id}')" class="px-4 bg-red-50 text-red-400 rounded-xl"><svg class="w-4 h-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                            </div>
                        </div>`;
                });
            });
        }

        function editDoc(id, data) {
            document.getElementById('formTitle').innerText = "Update: " + data.name;
            document.getElementById('editId').value = id;
            document.getElementById('sName').value = data.name;
            document.getElementById('sClass').value = data.class;
            document.getElementById('sPhone').value = data.phone;
            document.getElementById('sDob').value = data.dob || "";
            document.getElementById('fName').value = data.father || "";
            document.getElementById('mName').value = data.mother || "";
            document.getElementById('sWhatsapp').value = data.whatsapp || "";
            document.getElementById('sAadhar').value = data.aadhar || "";
            document.getElementById('sAddress').value = data.address || "";
            if(data.photo) {
                document.getElementById('imgPreview').src = data.photo;
                document.getElementById('imgPreview').classList.remove('hidden');
                document.getElementById('uploadPlaceholder').classList.add('hidden');
                studentPhoto = data.photo;
            }
            document.getElementById('saveBtn').innerText = "Update Profile";
            document.getElementById('cancelBtn').classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function searchStudent() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.student-card').forEach(c => {
                c.style.display = c.dataset.search.includes(q) ? "block" : "none";
            });
        }
        function deleteDoc(id) { if(confirm("Permanently delete this record?")) db.collection("students").doc(id).delete(); }

        loadData();
    </script>
</body>
</html>
